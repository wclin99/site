---
date:
  created: 2026-02-09
tags:
  - n8n
  - docker
  - axios
  - task-runners
  - è¸©å‘è®°å½•
---

# n8n Task Runners é…ç½®è¸©å‘å®å½•ï¼šä» "Cannot find name 'fetch'" åˆ°å®Œå…¨å¯ç”¨ axios

## å‰è¨€

åœ¨ä½¿ç”¨ n8n æ­å»ºè‡ªåŠ¨åŒ–å·¥ä½œæµæ—¶ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªçœ‹ä¼¼ç®€å•å´æŠ˜è…¾äº†å¾ˆä¹…çš„é—®é¢˜ï¼š**åœ¨ Code Node ä¸­ä½¿ç”¨ JavaScript çš„ `fetch` æˆ– `axios` è¿›è¡Œ HTTP è¯·æ±‚æ—¶ï¼Œç³»ç»ŸæŠ¥é”™æ— æ³•è¯†åˆ«**ã€‚

å…·ä½“ç¯å¢ƒï¼š
- n8n ç‰ˆæœ¬ï¼š2.6.3 (Self Hosted)
- éƒ¨ç½²æ–¹å¼ï¼šDocker Compose
- æ¶æ„ï¼šExternal Task Runnersï¼ˆå¤–ç½®ä»»åŠ¡è¿è¡Œå™¨ï¼‰

å¦‚æœä½ ä¹Ÿé‡åˆ° `Cannot find name 'fetch'` æˆ– `Module 'axios' is disallowed` çš„é”™è¯¯ï¼Œè¿™ç¯‡æ–‡ç« åº”è¯¥èƒ½å¸®åˆ°ä½ ã€‚

---

## è¸©å‘è®°å½•

### å‘ç‚¹1ï¼šè¯¯ä»¥ä¸ºåªéœ€è®¾ç½®ç¯å¢ƒå˜é‡

æœ€å¼€å§‹ï¼Œæˆ‘æŒ‰ç…§ç½‘ä¸Šèµ„æ–™åœ¨ `docker-compose.yml` ä¸­æ·»åŠ äº†ï¼š

```yaml
environment:
  - NODE_FUNCTION_ALLOW_EXTERNAL=axios
  - NODE_FUNCTION_ALLOW_BUILTIN=*
```

**ç»“æœ**ï¼šæŠ¥é”™ä¾æ—§ `Module 'axios' is disallowed [line 1]`

**åŸå› **ï¼šå½“ä½¿ç”¨ **External Task Runners** æ¨¡å¼æ—¶ï¼Œç¯å¢ƒå˜é‡å¹¶ä¸ä¼šè¢« runner æ­£ç¡®è¯»å–ã€‚å¿…é¡»é€šè¿‡é…ç½®æ–‡ä»¶ `n8n-task-runners.json` æ¥è®¾ç½®ã€‚

---

### å‘ç‚¹2ï¼šRunner å®¹å™¨å¯åŠ¨å¤±è´¥ï¼ˆchdir é”™è¯¯ï¼‰

åœ¨åˆ›å»ºäº†é…ç½®æ–‡ä»¶åï¼Œrunner å®¹å™¨ä¸€ç›´é‡å¯ï¼Œæ—¥å¿—æ˜¾ç¤ºï¼š

```
ERROR [launcher:js] Failed to execute `launch` command: failed to chdir into configured dir (): chdir : no such file or directory
```

**åŸå› **ï¼šé…ç½®æ–‡ä»¶ä¸­çš„ `workdir` å­—æ®µè®¾ç½®é”™è¯¯ã€‚é»˜è®¤åº”è¯¥æ˜¯ `/home/runner`ï¼Œè€Œæˆ‘ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ `/opt/runners/task-runner-javascript`ã€‚

---

### å‘ç‚¹3ï¼šé…ç½®æ–‡ä»¶å­—æ®µåé”™è¯¯

é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå­—æ®µæˆ‘ä»¥ä¸ºæ˜¯ `working-dir`ï¼Œä½†å®é™…ä¸Šåº”è¯¥æ˜¯ `workdir`ï¼ˆæ²¡æœ‰ ingï¼‰ã€‚

**æ­£ç¡®çš„å­—æ®µå**ï¼š
- âœ… `workdir` - å·¥ä½œç›®å½•
- âœ… `health-check-server-port` - å¥åº·æ£€æŸ¥ç«¯å£ï¼ˆæ³¨æ„éœ€è¦æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼‰
- âœ… `env-overrides` - ç¯å¢ƒå˜é‡è¦†ç›–

---

### å‘ç‚¹4ï¼šç«¯å£å†²çª

é…ç½®å¤šä¸ª runner æ—¶ï¼Œå‡ºç°é”™è¯¯ï¼š

```
ERROR Failed to load config: runner javascript: health-check-server-port 5680 conflicts with launcher health check server
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- Launcher é»˜è®¤ä½¿ç”¨ 5680 ç«¯å£ï¼ˆå¯é€šè¿‡ `N8N_RUNNERS_LAUNCHER_HEALTH_CHECK_PORT` ä¿®æ”¹ï¼‰
- JavaScript runner ä½¿ç”¨ 5681
- Python runner ä½¿ç”¨ 5682

---

### å‘ç‚¹5ï¼šä¸ç†è§£ Task Runners çš„ä¸‰å±‚é…ç½®æ¶æ„

è¿™æ˜¯æœ€å…³é”®çš„ä¸€ä¸ªå‘ã€‚n8n çš„ Task Runners æœ‰ä¸‰å±‚é…ç½®ï¼š

1. **n8n ä¸»å®¹å™¨** - é…ç½® brokerã€è®¤è¯ç­‰
2. **Runner å®¹å™¨** - é…ç½®è¿æ¥ broker çš„åœ°å€
3. **Launcher é…ç½®**ï¼ˆ`n8n-task-runners.json`ï¼‰- **çœŸæ­£æ§åˆ¶ä»£ç æ‰§è¡Œæƒé™çš„åœ°æ–¹**

**`NODE_FUNCTION_ALLOW_EXTERNAL` ç­‰ç¯å¢ƒå˜é‡åªåœ¨ n8n ä¸»å®¹å™¨è®¾ç½®æ˜¯ä¸å¤Ÿçš„**ï¼Œå¿…é¡»åœ¨ launcher çš„é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ `env-overrides` å­—æ®µè®¾ç½®ã€‚

---

## æ ¸å¿ƒæ¦‚å¿µï¼šTask Runners å·¥ä½œåŸç†

åœ¨æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œç†è§£ Task Runners çš„æ¶æ„å¾ˆé‡è¦ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      WebSocket       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   n8n ä¸»å®¹å™¨     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Runner å®¹å™¨     â”‚
â”‚  (Task Broker)  â”‚                      â”‚  (Launcher +     â”‚
â”‚                 â”‚                      â”‚   Task Runners)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                                           â”‚
       â”‚                                           â”‚
       â”‚         è¯»å– /etc/n8n-task-runners.json    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. Code Node å‘é€æ‰§è¡Œä»»åŠ¡åˆ° n8n çš„ Task Broker
2. Task Broker å°†ä»»åŠ¡åˆ†å‘ç»™å¯ç”¨çš„ Runner
3. Launcher æ ¹æ®é…ç½®å¯åŠ¨ JS æˆ– Python runner
4. Runner åœ¨æ²™ç®±ç¯å¢ƒä¸­æ‰§è¡Œä»£ç 

**å…³é”®ç‚¹**ï¼šRunner çš„æƒé™æ§åˆ¶å®Œå…¨ç”± launcher çš„é…ç½®æ–‡ä»¶å†³å®šï¼Œè€Œä¸æ˜¯ Docker çš„ç¯å¢ƒå˜é‡ã€‚

---

## å®Œæ•´è§£å†³æ–¹æ¡ˆ

### æ–‡ä»¶ç»“æ„

```
n8n-runner-config/
â”œâ”€â”€ docker-compose.yml          # Docker ç¼–æ’é…ç½®
â””â”€â”€ n8n-task-runners.json       # Task Runner é…ç½®æ–‡ä»¶ï¼ˆå…³é”®ï¼ï¼‰
```

### 1. docker-compose.yml

```yaml
version: "3.9"

services:
  # n8n ä¸»æœåŠ¡
  n8n:
    image: docker.n8n.io/n8nio/n8n:2.6.3
    container_name: n8n-main
    ports:
      - "5678:5678"
    environment:
      - TZ=Asia/Shanghai
      - GENERIC_TIMEZONE=Asia/Shanghai
      - N8N_RUNNERS_ENABLED=true        # å¯ç”¨ task runners
      - N8N_RUNNERS_MODE=external       # å¤–ç½®æ¨¡å¼
      - N8N_RUNNERS_BROKER_LISTEN_ADDRESS=0.0.0.0
      - N8N_RUNNERS_AUTH_TOKEN=n8n-secret-token
      - N8N_NATIVE_PYTHON_RUNNER=true
      - N8N_LOG_LEVEL=debug
    volumes:
      - n8n_data:/home/node/.n8n

  # Task Runnersï¼ˆå¤–ç½®è¿è¡Œå™¨ï¼‰
  n8n-runners:
    image: n8nio/runners:2.6.3          # ç‰ˆæœ¬å¿…é¡»ä¸ n8n åŒ¹é…
    container_name: n8n-runners
    environment:
      - N8N_RUNNERS_AUTH_TOKEN=n8n-secret-token
      - N8N_RUNNERS_TASK_BROKER_URI=http://n8n-main:5679
      - N8N_RUNNERS_AUTO_SHUTDOWN_TIMEOUT=0
      - N8N_RUNNERS_LAUNCHER_HEALTH_CHECK_PORT=5680
    depends_on:
      - n8n
    volumes:
      # ğŸ”´ å…³é”®ï¼šæŒ‚è½½é…ç½®æ–‡ä»¶åˆ° runner å®¹å™¨
      - ./n8n-task-runners.json:/etc/n8n-task-runners.json:ro

volumes:
  n8n_data:
    external: true
```

**é‡ç‚¹**ï¼š`./n8n-task-runners.json:/etc/n8n-task-runners.json:ro` è¿™ä¸€è¡Œæ˜¯å…³é”®ï¼Œå°†å®¿ä¸»æœºçš„é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„ `/etc/n8n-task-runners.json` è·¯å¾„ã€‚

### 2. n8n-task-runners.json

è¿™ä¸ªæ–‡ä»¶æ˜¯ä» runner é•œåƒçš„é»˜è®¤é…ç½®ä¿®æ”¹è€Œæ¥ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é»˜è®¤é…ç½®ï¼š

```bash
docker create --name temp-runner n8nio/runners:2.6.3
docker cp temp-runner:/etc/n8n-task-runners.json /tmp/default-config.json
docker rm temp-runner
```

ä»¥ä¸‹æ˜¯å®Œæ•´é…ç½®ï¼ˆå·²å¯ç”¨ axiosï¼‰ï¼š

```json
{
  "task-runners": [
    {
      "runner-type": "javascript",
      "workdir": "/home/runner",
      "command": "/usr/local/bin/node",
      "args": [
        "--disallow-code-generation-from-strings",
        "--disable-proto=delete",
        "/opt/runners/task-runner-javascript/dist/start.js"
      ],
      "health-check-server-port": "5681",
      "allowed-env": [
        "PATH",
        "GENERIC_TIMEZONE",
        "NODE_OPTIONS",
        "N8N_RUNNERS_AUTO_SHUTDOWN_TIMEOUT",
        "N8N_RUNNERS_TASK_TIMEOUT",
        "N8N_RUNNERS_MAX_CONCURRENCY",
        "N8N_SENTRY_DSN",
        "N8N_VERSION",
        "ENVIRONMENT",
        "DEPLOYMENT_NAME",
        "HOME"
      ],
      "env-overrides": {
        "NODE_FUNCTION_ALLOW_BUILTIN": "*",
        "NODE_FUNCTION_ALLOW_EXTERNAL": "axios",
        "N8N_RUNNERS_HEALTH_CHECK_SERVER_HOST": "0.0.0.0"
      }
    },
    {
      "runner-type": "python",
      "workdir": "/home/runner",
      "command": "/opt/runners/task-runner-python/.venv/bin/python",
      "args": ["-m", "src.main"],
      "health-check-server-port": "5682",
      "allowed-env": [
        "PATH",
        "N8N_RUNNERS_LAUNCHER_LOG_LEVEL",
        "N8N_RUNNERS_AUTO_SHUTDOWN_TIMEOUT",
        "N8N_RUNNERS_TASK_TIMEOUT",
        "N8N_RUNNERS_MAX_CONCURRENCY",
        "N8N_SENTRY_DSN",
        "N8N_VERSION",
        "ENVIRONMENT",
        "DEPLOYMENT_NAME"
      ],
      "env-overrides": {
        "PYTHONPATH": "/opt/runners/task-runner-python",
        "N8N_RUNNERS_STDLIB_ALLOW": "*",
        "N8N_RUNNERS_EXTERNAL_ALLOW": "*"
      }
    }
  ]
}
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š
- `NODE_FUNCTION_ALLOW_BUILTIN`: `"*"` - å…è®¸æ‰€æœ‰å†…ç½® Node.js æ¨¡å—
- `NODE_FUNCTION_ALLOW_EXTERNAL`: `"axios"` - å…è®¸ axios åŒ…ï¼ˆå¯æ·»åŠ å¤šä¸ªï¼Œç”¨é€—å·åˆ†éš”ï¼‰

### 3. å¯åŠ¨æœåŠ¡

```bash
docker-compose down
docker-compose up -d
```

### 4. éªŒè¯ runner çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ runner æ—¥å¿—
docker-compose logs -f n8n-runners
```

å½“çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—æ—¶ï¼Œè¡¨ç¤º runner å·²æˆåŠŸå¯åŠ¨å¹¶ç­‰å¾…ä»»åŠ¡ï¼š

```
INFO  [launcher:js] Waiting for task broker to be ready...
INFO  [launcher:js] Waiting for launcher's task offer to be accepted...
```

### 5. åœ¨ Code Node ä¸­ä½¿ç”¨ axios

ç°åœ¨å¯ä»¥åœ¨ n8n çš„ Code Node ä¸­æ„‰å¿«åœ°ä½¿ç”¨ axios äº†ï¼š

```javascript
var request = require('axios');

const response = await request({
    method: "GET",
    url: "https://httpbin.org/get",
});

// å¿…é¡»è¿”å›æ•°ç»„æ ¼å¼
return [response.data];
```

---

## æœ€ä½³å®è·µ

### 1. å®‰å…¨é…ç½®å»ºè®®

è™½ç„¶æˆ‘ä»¬ç¤ºä¾‹ä¸­ä½¿ç”¨äº† `"*"` æ¥å…è®¸æ‰€æœ‰å†…ç½®æ¨¡å—ï¼Œä½†ç”Ÿäº§ç¯å¢ƒå»ºè®®æ˜ç¡®æŒ‡å®šï¼š

```json
"env-overrides": {
  "NODE_FUNCTION_ALLOW_BUILTIN": "crypto,fs,path",
  "NODE_FUNCTION_ALLOW_EXTERNAL": "axios,lodash,moment",
  "N8N_RUNNERS_HEALTH_CHECK_SERVER_HOST": "0.0.0.0"
}
```

### 2. æ·»åŠ å…¶ä»– npm åŒ…

å¦‚æœéœ€è¦ä½¿ç”¨å…¶ä»– npm åŒ…ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š

**æ–¹æ³•A**ï¼šä½¿ç”¨é»˜è®¤é•œåƒä¸­å·²åŒ…å«çš„åŒ…ï¼ˆå¦‚ momentï¼‰

```json
"NODE_FUNCTION_ALLOW_EXTERNAL": "axios,moment"
```

**æ–¹æ³•B**ï¼šæ„å»ºè‡ªå®šä¹‰é•œåƒï¼ˆéœ€è¦é¢å¤–ä¾èµ–æ—¶ï¼‰

```dockerfile
FROM n8nio/runners:2.6.3
USER root
RUN cd /opt/runners/task-runner-javascript && pnpm add your-package
COPY n8n-task-runners.json /etc/n8n-task-runners.json
USER runner
```

### 3. æ•…éšœæ’æŸ¥å‘½ä»¤

```bash
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®æŒ‚è½½
docker exec n8n-runners cat /etc/n8n-task-runners.json

# 2. æŸ¥çœ‹ runner ç¯å¢ƒå˜é‡
docker exec n8n-runners env | grep NODE_FUNCTION

# 3. æ£€æŸ¥ runner æ—¥å¿—
docker-compose logs n8n-runners

# 4. éªŒè¯ n8n ä¸»å®¹å™¨é…ç½®
docker exec n8n-main env | grep N8N_RUNNERS
```

### 4. ç‰ˆæœ¬åŒ¹é…

**éå¸¸é‡è¦**ï¼šrunner é•œåƒç‰ˆæœ¬å¿…é¡»ä¸ n8n ä¸»é•œåƒç‰ˆæœ¬å®Œå…¨åŒ¹é…ï¼

```yaml
# âœ… æ­£ç¡® - ç‰ˆæœ¬ä¸€è‡´
n8n:
  image: docker.n8n.io/n8nio/n8n:2.6.3
n8n-runners:
  image: n8nio/runners:2.6.3

# âŒ é”™è¯¯ - ç‰ˆæœ¬ä¸ä¸€è‡´ä¼šå¯¼è‡´é€šä¿¡å¤±è´¥
n8n:
  image: docker.n8n.io/n8nio/n8n:2.6.3
n8n-runners:
  image: n8nio/runners:latest  # ä¸è¦è¿™æ ·åšï¼
```

---

## æ€»ç»“

n8n çš„ Task Runners æ¶æ„è™½ç„¶å¢åŠ äº†é…ç½®çš„å¤æ‚åº¦ï¼Œä½†æä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§å’Œèµ„æºéš”ç¦»ã€‚è¦å¯ç”¨ axios ç­‰å¤–éƒ¨æ¨¡å—ï¼Œå…³é”®åœ¨äºï¼š

1. **ç†è§£ä¸‰å±‚æ¶æ„**ï¼šn8n ä¸»å®¹å™¨ â†’ Runner å®¹å™¨ â†’ Launcher é…ç½®
2. **å¿…é¡»æŒ‚è½½é…ç½®æ–‡ä»¶**ï¼š`n8n-task-runners.json` æ˜¯æ§åˆ¶ä»£ç æ‰§è¡Œæƒé™çš„æ ¸å¿ƒ
3. **ç‰ˆæœ¬å¿…é¡»åŒ¹é…**ï¼šrunner å’Œ n8n ç‰ˆæœ¬è¦ä¸¥æ ¼ä¸€è‡´
4. **é€šè¿‡ `env-overrides` è®¾ç½®æƒé™**ï¼šè€Œä¸æ˜¯ Docker ç¯å¢ƒå˜é‡

å¸Œæœ›è¿™ç¯‡è¸©å‘è®°å½•èƒ½å¸®ä½ å°‘èµ°å¼¯è·¯ï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚

---

**å‚è€ƒé“¾æ¥**ï¼š
- [n8n Task Runners å®˜æ–¹æ–‡æ¡£](https://docs.n8n.io/hosting/configuration/task-runners/)
- [n8n Code Node æ¨¡å—é…ç½®](https://docs.n8n.io/hosting/configuration/configuration-examples/modules-in-code-node/)
- [Task Runner Launcher GitHub](https://github.com/n8n-io/task-runner-launcher)

**ç›¸å…³æ–‡ç« **ï¼š
- [n8n Python Runner é…ç½®è¸©å‘æŒ‡å—](./n8n-Python-Runner-é…ç½®è¸©å‘æŒ‡å—.md)
